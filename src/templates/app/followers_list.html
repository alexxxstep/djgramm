{% extends "base.html" %}

{% block title %}{{ target_user.username }}'s Followers | DJGramm{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h1 class="text-2xl font-semibold mb-6">
            <a href="{% url 'profile' username=target_user.username %}" class="hover:underline">
                {{ target_user.username }}
            </a>
            <span class="text-gray-500 font-normal">'s Followers</span>
        </h1>

        {% if follows %}
        <div class="space-y-4">
            {% for follow in follows %}
            <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                <div class="flex items-center space-x-4 flex-1">
                    <!-- Avatar -->
                    <a href="{% url 'profile' username=follow.follower.username %}">
                        {% if follow.follower.profile.avatar %}
                        <img src="{{ follow.follower.profile.avatar.url }}"
                             alt="{{ follow.follower.username }}"
                             class="w-12 h-12 rounded-full object-cover">
                        {% else %}
                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-bold">
                            {{ follow.follower.username|first|upper }}
                        </div>
                        {% endif %}
                    </a>

                    <!-- User Info -->
                    <div class="flex-1">
                        <a href="{% url 'profile' username=follow.follower.username %}" class="font-semibold hover:underline">
                            {{ follow.follower.username }}
                        </a>
                        {% if follow.follower.profile.full_name %}
                        <p class="text-sm text-gray-500">{{ follow.follower.profile.full_name }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Follow/Unfollow Button -->
                {% if user.is_authenticated and user != follow.follower %}
                    {% if follow.follower.id in user_following_ids %}
                    <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300 transition"
                            onclick="toggleFollow('{{ follow.follower.username }}', this)">
                        Unfollow
                    </button>
                    {% else %}
                    <button class="px-4 py-2 bg-primary text-white rounded-lg font-semibold text-sm hover:bg-opacity-90 transition"
                            onclick="toggleFollow('{{ follow.follower.username }}', this)">
                        Follow
                    </button>
                    {% endif %}
                {% endif %}
            </div>
            {% endfor %}
        </div>

        {% include "app/_pagination.html" %}
        {% else %}
        <p class="text-gray-500 text-center py-8">No followers yet.</p>
        {% endif %}
    </div>
</div>

{% if user.is_authenticated %}
<script>
function toggleFollow(username, button) {
    fetch(`/profile/${username}/follow/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrf-token]').content,
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
            return;
        }
        button.textContent = data.is_following ? 'Unfollow' : 'Follow';
        button.classList.toggle('bg-primary');
        button.classList.toggle('text-white');
        button.classList.toggle('bg-gray-200');
        button.classList.toggle('text-gray-700');
    });
}
</script>
{% endif %}
{% endblock %}

