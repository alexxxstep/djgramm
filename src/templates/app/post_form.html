{% extends "base.html" %}

{% block title %}{% if is_edit %}Edit{% else %}New{% endif %} Post | DJGramm{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <h1 class="text-xl font-semibold mb-6">
            {% if is_edit %}Edit Post{% else %}Create New Post{% endif %}
        </h1>

        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            {% if form.errors or image_formset.errors %}
            <div class="bg-red-50 text-red-600 p-4 rounded-lg">
                {% for field in form %}
                    {% for error in field.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                {% endfor %}
            </div>
            {% endif %}

            <!-- Images -->
            <div>
                <label class="block text-gray-700 font-medium mb-2">Photos</label>
                <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-primary transition cursor-pointer" id="dropzone">
                    <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <p class="text-gray-600 mb-2">Drag photos here or click to select</p>
                    <p class="text-gray-400 text-sm">JPEG, PNG, WebP up to 10MB</p>
                </div>

                <!-- Image inputs -->
                <div class="mt-4 space-y-3" id="image-inputs">
                    {{ image_formset.management_form }}
                    {% for img_form in image_formset %}
                    <div class="flex items-center space-x-3">
                        <input type="file" name="{{ img_form.image.html_name }}" accept="image/*"
                               class="flex-1 text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-opacity-90">
                        {% if img_form.instance.pk %}
                        <label class="flex items-center text-red-500 text-sm">
                            <input type="checkbox" name="{{ img_form.DELETE.html_name }}" class="mr-1">
                            Delete
                        </label>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Caption -->
            <div>
                <label class="block text-gray-700 font-medium mb-2">Caption</label>
                <textarea name="caption" rows="4"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none"
                          placeholder="Write a caption..." maxlength="2200">{{ form.caption.value|default:'' }}</textarea>
                <p class="text-gray-400 text-sm mt-1">{{ form.caption.value|length|default:0 }}/2200</p>
            </div>

            <!-- Submit -->
            <div class="flex space-x-4">
                <button type="submit"
                        class="flex-1 bg-primary text-white py-3 rounded-lg font-semibold hover:bg-opacity-90 transition">
                    {% if is_edit %}Save Changes{% else %}Share{% endif %}
                </button>
                <a href="{% if is_edit %}{{ object.get_absolute_url }}{% else %}{% url 'feed' %}{% endif %}"
                   class="flex-1 text-center border border-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50 transition">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
