# DJGramm TASK14 — План налаштування frontend інструментів

## Огляд завдання

Модифікувати проект, додавши frontend інструменти (webpack) та інтегрувавши CSS фреймворк Tailwind CSS через webpack замість CDN.

**Основні цілі:**

1. **Налаштування webpack** — встановлення та конфігурація webpack для збірки JavaScript та CSS
2. **Інтеграція Tailwind CSS** — заміна CDN на локальну збірку через webpack
3. **AJAX функціональність** — покращення та оптимізація існуючих AJAX запитів
4. **Деплой** — оновлення процесу деплою для роботи з webpack
5. **Тестування** — написання тестів для нових функцій (pytest)

---

## Поточний стан проекту

### Що вже реалізовано:

- ✅ **Tailwind CSS** — використовується через CDN в `base.html`
- ✅ **JavaScript файли** — існують в `src/static/js/`:
  - `follow.js` — AJAX підписка/відписка
  - `feed.js` — функціональність стрічки
  - `post_detail.js` — деталі поста
  - `post_form.js` — форма створення поста
  - `main.js` — основний файл (поки порожній)
- ✅ **Pytest** — налаштований та працює, тести в `tests/`
- ✅ **Деплой** — налаштований через Docker (`docker-compose.prod.yml`)

### Що потрібно додати:

- ❌ **Webpack** — не налаштований (немає `package.json`, `webpack.config.js`)
- ❌ **Tailwind через webpack** — заміна CDN на локальну збірку
- ⚠️ **Оптимізація JavaScript** — об'єднання файлів, мініфікація
- ⚠️ **CSS обробка** — збірка Tailwind через PostCSS
- ⚠️ **Оновлення деплою** — додати збірку frontend в процес деплою

---

## Фази реалізації

### Фаза 1: Налаштування Node.js та webpack

#### Крок 1.1: Встановлення Node.js залежностей

**Дії:**

1. Створити `package.json` в корені проекту
2. Встановити webpack та необхідні залежності:
   - `webpack` та `webpack-cli` (основні пакети)
   - `webpack-bundle-analyzer` (для аналізу розміру бандлу, опціонально)
   - `css-loader` та `style-loader` (для обробки CSS)
   - `postcss-loader` та `autoprefixer` (для PostCSS)
   - `tailwindcss` (локальна версія замість CDN)
   - `mini-css-extract-plugin` (для витягування CSS в окремий файл)
   - `terser-webpack-plugin` (для мініфікації JavaScript)
   - `copy-webpack-plugin` (для копіювання статичних файлів, якщо потрібно)

3. Додати dev-залежності:
   - `webpack-dev-server` (для розробки, опціонально)

**Результат:** `package.json` створений з усіма необхідними залежностями

#### Крок 1.2: Створення структури frontend файлів

**Дії:**

1. Створити папку `frontend/` в корені проекту (або `src/frontend/`)
2. Створити підпапки:
   - `frontend/src/` — вихідні JavaScript файли
   - `frontend/src/css/` — вихідні CSS файли (включаючи Tailwind)
   - `frontend/dist/` — зібрані файли (буде ігноруватися в git)

**Результат:** Структура папок для frontend файлів готова

#### Крок 1.3: Налаштування webpack.config.js

**Дії:**

1. Створити `webpack.config.js` в корені проекту
2. Налаштувати:
   - **Entry points** — вказати точки входу (основний JS файл, CSS файл)
   - **Output** — налаштувати вихідну папку (`src/static/dist/` або `src/staticfiles/`)
   - **Mode** — налаштувати режими `development` та `production`
   - **Loaders** — налаштувати обробку:
     - JavaScript файлів (Babel, якщо потрібно)
     - CSS файлів через `css-loader` та `style-loader`
     - PostCSS для Tailwind через `postcss-loader`
   - **Plugins** — додати:
     - `MiniCssExtractPlugin` для витягування CSS
     - `TerserPlugin` для мініфікації в production
   - **Optimization** — налаштувати оптимізацію для production

3. Додати окремий конфіг для development (опціонально)

**Результат:** Webpack налаштований для збірки JavaScript та CSS

---

### Фаза 2: Інтеграція Tailwind CSS через webpack

#### Крок 2.1: Встановлення та налаштування Tailwind CSS

**Дії:**

1. Ініціалізувати Tailwind CSS (створити `tailwind.config.js`)
2. Налаштувати `tailwind.config.js`:
   - Вказати шляхи до шаблонів Django (`content` paths)
   - Налаштувати кастомні кольори (якщо є в поточному конфігу)
   - Додати кастомні теми, якщо потрібно

3. Створити основний CSS файл (`frontend/src/css/main.css` або подібний):
   - Додати директиви Tailwind (`@tailwind base`, `@tailwind components`, `@tailwind utilities`)
   - Додати кастомні стилі, якщо є

4. Налаштувати PostCSS (`postcss.config.js`):
   - Додати `tailwindcss` плагін
   - Додати `autoprefixer` плагін

**Результат:** Tailwind CSS налаштований для роботи через webpack

#### Крок 2.2: Оновлення шаблонів Django

**Дії:**

1. Видалити CDN посилання на Tailwind з `base.html`
2. Додати посилання на зібраний CSS файл через `{% static %}` тег
3. Перевірити, що всі класи Tailwind працюють після зміни

**Результат:** Tailwind CSS завантажується з локальної збірки замість CDN

#### Крок 2.3: Налаштування webpack для Tailwind

**Дії:**

1. Оновити `webpack.config.js`:
   - Додати обробку CSS файлів через PostCSS
   - Налаштувати `postcss-loader` з Tailwind
   - Переконатися, що Tailwind класи з шаблонів скануються

2. Протестувати збірку:
   - Запустити `npm run build` (або `yarn build`)
   - Перевірити, що CSS файл створений
   - Перевірити, що всі стилі працюють

**Результат:** Tailwind збирається через webpack

---

### Фаза 3: Реорганізація JavaScript файлів

#### Крок 3.1: Об'єднання JavaScript модулів

**Дії:**

1. Реорганізувати існуючі JS файли:
   - Перемістити файли з `src/static/js/` в `frontend/src/`
   - Розбити на модулі (ES6 modules), якщо потрібно
   - Створити основний entry point (`frontend/src/index.js`)

2. Налаштувати імпорти:
   - Імпортувати всі модулі в головний файл
   - Налаштувати залежності між модулями

3. Додати утиліти (якщо потрібно):
   - Функції для роботи з CSRF токенами
   - Загальні AJAX утиліти
   - Обробка помилок

**Результат:** JavaScript файли реорганізовані та готові до збірки

#### Крок 3.2: Покращення AJAX функціональності

**Дії:**

1. Оптимізувати існуючі AJAX запити:
   - Додати загальну обробку помилок
   - Додати індикатори завантаження
   - Покращити обробку відповідей

2. Додати нові AJAX функції (якщо потрібно):
   - Infinite scroll для стрічки (опціонально)
   - Real-time оновлення (опціонально)
   - Покращена обробка форм

3. Додати валідацію на клієнті (якщо потібно)

**Результат:** AJAX функціональність покращена та оптимізована

#### Крок 3.3: Налаштування webpack для JavaScript

**Дії:**

1. Оновити `webpack.config.js`:
   - Налаштувати entry point для JavaScript
   - Додати обробку ES6+ синтаксису (Babel, якщо потрібно)
   - Налаштувати мініфікацію для production

2. Протестувати збірку:
   - Перевірити, що всі модулі збираються
   - Перевірити, що мініфікація працює
   - Перевірити, що source maps працюють (для debugging)

**Результат:** JavaScript збирається через webpack

---

### Фаза 4: Оновлення Django settings для статичних файлів

#### Крок 4.1: Налаштування STATICFILES_DIRS

**Дії:**

1. Оновити `src/config/settings.py`:
   - Додати шлях до зібраних файлів в `STATICFILES_DIRS` (якщо потрібно)
   - Переконатися, що `STATIC_ROOT` вказує на правильну папку

2. Налаштувати обробку статичних файлів:
   - Переконатися, що WhiteNoise налаштований правильно
   - Перевірити, що зібрані файли знаходяться в правильній папці

**Результат:** Django знає, де знаходяться зібрані статичні файли

#### Крок 4.2: Оновлення шаблонів

**Дії:**

1. Оновити `base.html`:
   - Замінити посилання на окремі JS файли на зібраний bundle
   - Замінити CDN Tailwind на локальний CSS файл

2. Перевірити всі шаблони:
   - Переконатися, що всі статичні файли завантажуються правильно
   - Перевірити, що немає конфліктів з існуючими скриптами

**Результат:** Шаблони оновлені для використання зібраних файлів

---

### Фаза 5: Налаштування скриптів збірки

#### Крок 5.1: Додавання npm scripts

**Дії:**

1. Оновити `package.json`:
   - Додати скрипт `build` для production збірки
   - Додати скрипт `dev` для development збірки (з watch mode)
   - Додати скрипт `watch` для автоматичної перезбірки під час розробки

2. Налаштувати змінні оточення:
   - Використовувати `NODE_ENV` для визначення режиму
   - Налаштувати різні конфіги для development та production

**Результат:** Скрипти для збірки налаштовані

#### Крок 5.2: Інтеграція з Django командами (опціонально)

**Дії:**

1. Створити Django management command:
   - Команда для запуску webpack збірки
   - Команда для комбінованого запуску (міграції + збірка)

2. Додати в процес розробки:
   - Автоматичний запуск збірки перед `runserver` (опціонально)
   - Інтеграція з Docker (опціонально)

**Результат:** Збірка інтегрована в Django workflow

---

### Фаза 6: Оновлення процесу деплою

#### Крок 6.1: Оновлення Dockerfile

**Дії:**

1. Оновити `docker/Dockerfile` та `docker/Dockerfile.prod`:
   - Додати встановлення Node.js
   - Додати встановлення npm залежностей (`npm install`)
   - Додати збірку frontend (`npm run build`)
   - Оптимізувати порядок операцій для кешування

2. Налаштувати multi-stage build (якщо потрібно):
   - Stage 1: Встановлення Node.js та збірка frontend
   - Stage 2: Python та Django setup
   - Stage 3: Фінальний образ

**Результат:** Dockerfile оновлений для збірки frontend

#### Крок 6.2: Оновлення docker-compose

**Дії:**

1. Оновити `docker-compose.yml` та `docker-compose.prod.yml`:
   - Переконатися, що volumes правильно налаштовані
   - Додати змінні оточення для Node.js (якщо потрібно)

2. Оновити entrypoint скрипти:
   - Додати збірку frontend перед запуском Django
   - Переконатися, що `collectstatic` виконується після збірки

**Результат:** Docker Compose оновлений для роботи з webpack

#### Крок 6.3: Оновлення CI/CD (якщо є)

**Дії:**

1. Оновити GitLab CI / GitHub Actions:
   - Додати встановлення Node.js
   - Додати збірку frontend перед тестами
   - Переконатися, що зібрані файли включені в артефакти

2. Додати перевірки:
   - Перевірка розміру bundle (опціонально)
   - Перевірка мініфікації (опціонально)

**Результат:** CI/CD оновлений для роботи з webpack

---

### Фаза 7: Тестування

#### Крок 7.1: Тести для frontend функціональності

**Дії:**

1. Написати тести для JavaScript (опціонально):
   - Використовувати Jest або інший JS test runner
   - Тестувати AJAX функції
   - Тестувати утиліти

2. Інтеграційні тести:
   - Тестувати, що зібрані файли завантажуються
   - Тестувати, що всі функції працюють після збірки

**Результат:** Тести для frontend написані (якщо вирішено додати)

#### Крок 7.2: Оновлення існуючих pytest тестів

**Дії:**

1. Перевірити існуючі тести:
   - Переконатися, що тести проходять після змін
   - Оновити тести, якщо потрібно (наприклад, перевірка статичних файлів)

2. Додати нові тести (якщо потрібно):
   - Тести для перевірки наявності зібраних файлів
   - Тести для перевірки правильності завантаження статичних файлів

**Результат:** Pytest тести оновлені та проходять

#### Крок 7.3: Ручне тестування

**Дії:**

1. Протестувати в development режимі:
   - Перевірити, що всі сторінки завантажуються
   - Перевірити, що всі JavaScript функції працюють
   - Перевірити, що всі стилі застосовуються правильно

2. Протестувати в production режимі:
   - Перевірити мініфікацію
   - Перевірити оптимізацію
   - Перевірити розмір файлів

**Результат:** Всі функції протестовані вручну

---

## Додаткові покращення (опціонально)

### Code Splitting

**Інструкції:**

1. Налаштувати code splitting в webpack:
   - Розділити код на chunks
   - Використовувати dynamic imports для лazy loading

2. Переваги:
   - Менший розмір початкового bundle
   - Швидше завантаження сторінок

### Source Maps

**Інструкції:**

1. Налаштувати source maps в webpack:
   - Для development: детальні source maps
   - Для production: мінімальні source maps (або без них)

2. Переваги:
   - Легше debugging в браузері
   - Краще відстеження помилок

### Hot Module Replacement (HMR)

**Інструкції:**

1. Налаштувати HMR для development:
   - Використовувати `webpack-dev-server`
   - Налаштувати автоматичне оновлення без перезавантаження

2. Переваги:
   - Швидша розробка
   - Збереження стану під час змін

---

## Checklist перед завершенням

### Налаштування

- [ ] `package.json` створений з усіма залежностями
- [ ] `webpack.config.js` налаштований для development та production
- [ ] `tailwind.config.js` налаштований з правильними paths
- [ ] `postcss.config.js` налаштований з Tailwind та Autoprefixer
- [ ] Структура frontend папок створена

### Інтеграція

- [ ] Tailwind CDN видалено з `base.html`
- [ ] Зібраний CSS файл підключено в шаблонах
- [ ] Зібраний JavaScript bundle підключено в шаблонах
- [ ] Всі існуючі функції працюють після змін

### Збірка

- [ ] `npm run build` працює без помилок
- [ ] `npm run dev` працює для розробки
- [ ] Мініфікація працює в production режимі
- [ ] Source maps працюють (якщо налаштовані)

### Деплой

- [ ] Dockerfile оновлений для збірки frontend
- [ ] docker-compose оновлений
- [ ] CI/CD оновлений (якщо є)
- [ ] Деплой на сервер працює з новими змінами

### Тестування

- [ ] Всі існуючі pytest тести проходять
- [ ] Ручне тестування пройдено
- [ ] Перевірено в development та production режимах
- [ ] Перевірено розмір bundle (не надто великий)

### Документація

- [ ] README оновлений з інструкціями по збірці
- [ ] Додано інструкції по встановленню Node.js залежностей
- [ ] Додано інструкції по запуску збірки

---

## Ресурси

- [Webpack Documentation](https://webpack.js.org/concepts/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [PostCSS Documentation](https://postcss.org/)
- [Django Static Files](https://docs.djangoproject.com/en/stable/howto/static-files/)
- [Webpack + Django Integration](https://webpack.js.org/guides/production/)

---

## Підсумок

**TASK14 додає до проекту:**

- Webpack для збірки frontend ресурсів
- Tailwind CSS інтегрований через webpack (замість CDN)
- Оптимізовані та мініфіковані JavaScript та CSS файли
- Покращений процес деплою з автоматичною збіркою frontend
- Готовність до масштабування frontend функціональності

**Готово до початку реалізації!**

